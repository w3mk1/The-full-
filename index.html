<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNTF Go Pro - Notifications Enabled</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        :root {
            --md-primary: #006d3a;
            --md-surface: #f3f4f1;
            --md-card: #ffffff;
            --md-text: #1a1c19;
            --md-outline: #72796f;
        }

        .dark-mode {
            --md-surface: #111411;
            --md-card: #1c1f1c;
            --md-text: #e2e3dd;
            --md-outline: #424940;
        }

        body {
            background: var(--md-surface);
            color: var(--md-text);
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0; padding: 10px;
            transition: 0.3s;
        }

        .app-container { max-width: 500px; margin: auto; }

        .card {
            background: var(--md-card);
            border-radius: 28px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid var(--md-outline);
        }

        .input-field {
            background: var(--md-surface);
            padding: 12px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            position: relative;
        }

        input {
            background: none; border: none; outline: none;
            color: inherit; width: 100%; font-size: 16px;
        }

        .suggestion-box {
            position: absolute; top: 100%; left: 0; right: 0;
            background: var(--md-card); z-index: 2000;
            max-height: 150px; overflow-y: auto;
            border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .suggestion-item:hover { background: var(--md-primary); color: white; }

        .btn-gps {
            background: #e8f5e9; color: var(--md-primary);
            border: 1px solid var(--md-primary);
            width: 100%; padding: 10px; border-radius: 100px;
            cursor: pointer; margin-bottom: 10px; font-weight: bold;
        }

        .btn-primary {
            background: var(--md-primary); color: white; border: none;
            width: 100%; padding: 16px; border-radius: 100px;
            font-weight: bold; cursor: pointer; font-size: 16px;
        }

        #map { height: 250px; border-radius: 20px; margin-top: 10px; z-index: 1; }
        
        .ticket {
            background: var(--md-primary); color: white;
            padding: 20px; border-radius: 24px; margin-top: 15px;
        }

        .notify-btn {
            width: 100%; padding: 12px; margin-top: 10px; 
            border-radius: 12px; border: 2px dashed white; 
            background: rgba(255,255,255,0.1); color: white;
            font-weight: bold; cursor: pointer;
        }

        header { display: flex; justify-content: space-between; align-items: center; padding: 10px; }
        
        .lang-select {
            padding: 8px; border-radius: 10px; background: var(--md-card);
            color: var(--md-text); border: 1px solid var(--md-outline);
        }
    </style>
</head>
<body class="light-mode">

    <div class="app-container">
        <header>
            <div id="app-logo" style="font-weight: bold; font-size: 1.3rem;">ğŸš† SNTF Go Pro</div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <select id="lang-selector" class="lang-select" onchange="changeLanguage()">
                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="fr">FranÃ§ais</option>
                    <option value="en">English</option>
                </select>
                <button onclick="toggleTheme()" style="background:none; border:none; cursor:pointer; font-size:1.5rem;">ğŸŒ™</button>
            </div>
        </header>

        <div class="card">
            <button class="btn-gps" id="gps-btn" onclick="getLocation()">
                <i class="fas fa-crosshairs"></i> ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø·Ø©
            </button>
            
            <div class="input-field">
                <i class="fas fa-map-marker-alt" style="color:var(--md-primary)"></i>
                <input type="text" id="from-input" onkeyup="filterStations('from')">
                <div id="from-list" class="suggestion-box"></div>
            </div>

            <div class="input-field">
                <i class="fas fa-flag-checkered"></i>
                <input type="text" id="to-input" onkeyup="filterStations('to')">
                <div id="to-list" class="suggestion-box"></div>
            </div>

            <button class="btn-primary" id="search-btn" onclick="startTracking()">Ø¨Ø­Ø« ÙˆØªØªØ¨Ø¹</button>
        </div>

        <div id="map-section" class="card" style="display:none;">
            <div id="map"></div>
            <p id="status-text" style="text-align: center; margin-top: 10px; font-weight: bold;"></p>
        </div>

        <div id="results"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø« Ù…Ø¹ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        const translations = {
            ar: {
                logo: "ğŸš† SNTF Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±",
                gps: "ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø·Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
                from: "Ù…Ù† (Ø§Ù†Ø·Ù„Ø§Ù‚)...",
                to: "Ø¥Ù„Ù‰ (ÙˆØµÙˆÙ„)...",
                search: "Ø¨Ø­Ø« ÙˆØªØªØ¨Ø¹ Ø§Ù„Ø±Ø­Ù„Ø©",
                tracking: "Ø§Ù„Ù‚Ø·Ø§Ø± ÙŠØªØ­Ø±Ùƒ Ø§Ù„Ø¢Ù† Ù…Ù† ",
                ticketTitle: "ğŸ« ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©",
                price: "Ø§Ù„Ø³Ø¹Ø±: 120 Ø¯Ø¬",
                notify: "ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ø±Ø­Ù„Ø©",
                gpsSuccess: "ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ! Ø§Ù„Ø£Ù‚Ø±Ø¨ Ù‡ÙŠ: ",
                error: "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø·Ø§Øª Ø£ÙˆÙ„Ø§Ù‹",
                notifTitle: "SNTF Go - ØªÙ†Ø¨ÙŠÙ‡",
                notifBody: "Ø§Ù„Ù‚Ø·Ø§Ø± ÙŠÙ‚ØªØ±Ø¨ Ù…Ù† Ù…Ø­Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„! Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù†Ø²ÙˆÙ„."
            },
            fr: {
                logo: "ğŸš† SNTF AlgÃ©rie",
                gps: "Trouver la gare la plus proche",
                from: "De (DÃ©part)...",
                to: "Ã€ (ArrivÃ©e)...",
                search: "Rechercher et Suivre",
                tracking: "Le train se dÃ©place de ",
                ticketTitle: "ğŸ« DÃ©tails du voyage",
                price: "Prix: 120 DZD",
                notify: "ğŸ”” Activer les notifications",
                gpsSuccess: "Position trouvÃ©e! La plus proche: ",
                error: "Veuillez choisir les gares",
                notifTitle: "SNTF Go - Alerte",
                notifBody: "Le train approche de votre destination !"
            },
            en: {
                logo: "ğŸš† SNTF Algeria",
                gps: "Find Nearest Station",
                from: "From (Departure)...",
                to: "To (Arrival)...",
                search: "Search & Track",
                tracking: "Train is moving from ",
                ticketTitle: "Trip Details",
                price: "Price: 120 DZD",
                notify: "ğŸ”” Enable Notifications",
                gpsSuccess: "Location found! Nearest: ",
                error: "Please select stations first",
                notifTitle: "SNTF Go - Alert",
                notifBody: "The train is approaching your destination!"
            }
        };

        const stationsDB = [
            { nameAr: "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± - Ø¢ØºØ§", nameFr: "Alger - Agha", nameEn: "Algiers - Agha", lat: 36.7645, lng: 3.0515 },
            { nameAr: "Ø¨Ù†ÙŠ Ù…Ø±Ø§Ø¯", nameFr: "Beni Mourad", nameEn: "Beni Mourad", lat: 36.5050, lng: 2.8610 },
            { nameAr: "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©", nameFr: "Blida", nameEn: "Blida", lat: 36.4701, lng: 2.8288 },
            { nameAr: "ÙˆÙ‡Ø±Ø§Ù†", nameFr: "Oran", nameEn: "Oran", lat: 35.6971, lng: -0.6308 },
            { nameAr: "Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", nameFr: "Constantine", nameEn: "Constantine", lat: 36.3650, lng: 6.6147 }
        ];

        let currentLang = 'ar';
        let map, routeLine;

        function changeLanguage() {
            currentLang = document.getElementById('lang-selector').value;
            const t = translations[currentLang];
            document.getElementById('app-logo').innerText = t.logo;
            document.getElementById('gps-btn').innerHTML = `<i class="fas fa-crosshairs"></i> ${t.gps}`;
            document.getElementById('from-input').placeholder = t.from;
            document.getElementById('to-input').placeholder = t.to;
            document.getElementById('search-btn').innerText = t.search;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        }

        // Ø®Ø§ØµÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function enableNotifications() {
            if (!("Notification" in window)) {
                alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.");
                return;
            }

            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    const t = translations[currentLang];
                    // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ ÙÙˆØ±ÙŠ
                    new Notification(t.notifTitle, {
                        body: t.notifBody,
                        icon: "https://cdn-icons-png.flaticon.com/512/785/785431.png"
                    });
                }
            });
        }

        function filterStations(type) {
            const query = document.getElementById(`${type}-input`).value.toLowerCase();
            const list = document.getElementById(`${type}-list`);
            list.innerHTML = "";
            if (query.length < 1) return;

            stationsDB.forEach(s => {
                const name = currentLang === 'ar' ? s.nameAr : (currentLang === 'fr' ? s.nameFr : s.nameEn);
                if (name.toLowerCase().includes(query)) {
                    const div = document.createElement('div');
                    div.className = "suggestion-item";
                    div.innerText = name;
                    div.onclick = () => selectStation(type, name, s.lat, s.lng);
                    list.appendChild(div);
                }
            });
        }

        function selectStation(type, name, lat, lng) {
            const input = document.getElementById(`${type}-input`);
            input.value = name;
            input.setAttribute('data-lat', lat);
            input.setAttribute('data-lng', lng);
            document.getElementById(`${type}-list`).innerHTML = "";
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const uLat = position.coords.latitude;
                    const uLng = position.coords.longitude;
                    let closest = stationsDB[0];
                    let minDist = Infinity;
                    stationsDB.forEach(s => {
                        const d = Math.sqrt(Math.pow(uLat - s.lat, 2) + Math.pow(uLng - s.lng, 2));
                        if (d < minDist) { minDist = d; closest = s; }
                    });
                    const name = currentLang === 'ar' ? closest.nameAr : (currentLang === 'fr' ? closest.nameFr : closest.nameEn);
                    selectStation('from', name, closest.lat, closest.lng);
                    alert(translations[currentLang].gpsSuccess + name);
                });
            }
        }

        function startTracking() {
            const f = document.getElementById('from-input');
            const t = document.getElementById('to-input');
            if (!f.getAttribute('data-lat') || !t.getAttribute('data-lat')) return alert(translations[currentLang].error);

            document.getElementById('map-section').style.display = 'block';
            const sPos = [f.getAttribute('data-lat'), f.getAttribute('data-lng')];
            const ePos = [t.getAttribute('data-lat'), t.getAttribute('data-lng')];

            if (!map) {
                map = L.map('map').setView(sPos, 10);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            } else { map.setView(sPos, 10); }

            if(routeLine) map.removeLayer(routeLine);
            routeLine = L.polyline([sPos, ePos], {color: 'green', weight: 5}).addTo(map);
            L.marker(sPos).addTo(map);
            L.marker(ePos).addTo(map);

            document.getElementById('status-text').innerText = translations[currentLang].tracking + f.value;
            showResults(f.value, t.value);
        }

        function showResults(from, to) {
            const t = translations[currentLang];
            document.getElementById('results').innerHTML = `
                <div class="ticket">
                    <h3>${t.ticketTitle}</h3>
                    <p>${from} â®• ${to}</p>
                    <p>${t.price} | â±ï¸ 08:45</p>
                    <button class="notify-btn" onclick="enableNotifications()">${t.notify}</button>
                </div>
            `;
        }

        function toggleTheme() { document.body.classList.toggle('dark-mode'); }
        window.onload = changeLanguage;
    </script>
</body>
</html>
