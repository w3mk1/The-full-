<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNTF Go Pro - Ultimate</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        :root {
            --md-primary: #006d3a;
            --md-surface: #f3f4f1;
            --md-card: #ffffff;
            --md-text: #1a1c19;
            --md-outline: #72796f;
        }

        .dark-mode {
            --md-surface: #111411;
            --md-card: #1c1f1c;
            --md-text: #e2e3dd;
            --md-outline: #424940;
        }

        body {
            background: var(--md-surface);
            color: var(--md-text);
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0; padding: 10px;
            transition: 0.3s;
        }

        .app-container { max-width: 500px; margin: auto; }

        header { display: flex; justify-content: space-between; align-items: center; padding: 10px; }

        .card {
            background: var(--md-card);
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid var(--md-outline);
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ */
        .schedule-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .schedule-table td { padding: 12px 8px; border-bottom: 1px solid var(--md-surface); font-weight: 500; text-align: center; }
        .price-badge { background: var(--md-primary); color: white; padding: 4px 10px; border-radius: 8px; font-size: 0.8rem; }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ© */
        .net-status { font-size: 0.7rem; padding: 4px 12px; border-radius: 20px; }
        .online { background: #e8f5e9; color: #2e7d32; }
        .offline { background: #ffebee; color: #c62828; }

        #map { height: 200px; border-radius: 16px; margin-top: 10px; z-index: 1; }
        
        .btn-main {
            background: var(--md-primary); color: white; border: none;
            width: 100%; padding: 15px; border-radius: 100px;
            font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        .lang-select { padding: 8px; border-radius: 10px; background: var(--md-card); color: var(--md-text); border: 1px solid var(--md-outline); }
    </style>
</head>
<body class="light-mode">

<div class="app-container">
    <header>
        <div id="app-logo" style="font-weight: bold; font-size: 1.2rem;">ğŸš† SNTF Go Pro</div>
        <div style="display: flex; gap: 8px;">
            <select id="lang-selector" class="lang-select" onchange="changeLanguage()">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="fr">FranÃ§ais</option>
                <option value="en">English</option>
            </select>
            <button onclick="toggleTheme()" style="background:none; border:none; cursor:pointer; font-size:1.4rem;">ğŸŒ™</button>
        </div>
    </header>

    <div style="text-align: center; margin-bottom: 10px;">
        <span id="net-indicator" class="net-status online">Ù…ØªØµÙ„</span>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <strong id="route-title">Ø¨Ù†ÙŠ Ù…Ø±Ø§Ø¯ â®• Ø¢ØºØ§</strong><br>
                <small id="route-sub">Ø®Ø· Ø§Ù„Ø¶ÙˆØ§Ø­ÙŠ (Algier-Ouest)</small>
            </div>
            <span class="price-badge">40 Ø¯Ø¬</span>
        </div>
        <button class="btn-main" id="gps-btn" onclick="getLocation()"><i class="fas fa-location-crosshairs"></i> Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø·Ø©</button>
    </div>

    <div class="card">
        <h4 style="margin:0"><i class="far fa-clock"></i> <span id="time-title">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„Ø±Ø­Ù„Ø§Øª</span></h4>
        <table class="schedule-table">
            <tbody id="schedule-body">
                </tbody>
        </table>
        <button class="btn-main" style="background:#444" onclick="syncData()" id="sync-btn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
    </div>

    <div class="card">
        <h4 style="margin:0"><i class="fas fa-map-marked-alt"></i> <span id="map-title">Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</span></h4>
        <div id="map"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ±Ø¬Ù…Ø§Øª
    const translations = {
        ar: { logo: "ğŸš† SNTF Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", gps: "Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø·Ø©", time: "Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„Ø±Ø­Ù„Ø§Øª", sync: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯", map: "Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ", route: "Ø¨Ù†ÙŠ Ù…Ø±Ø§Ø¯ â®• Ø¢ØºØ§", online: "Ù…ØªØµÙ„", offline: "ÙˆØ¶Ø¹ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„" },
        fr: { logo: "ğŸš† SNTF AlgÃ©rie", gps: "Gare Proche", time: "Horaires", sync: "Actualiser", map: "ItinÃ©raire", route: "B.Mered â®• Agha", online: "En ligne", offline: "Mode Hors-ligne" },
        en: { logo: "ğŸš† SNTF Algeria", gps: "Nearest Station", time: "Schedules", sync: "Update Data", map: "Live Map", route: "B.Mered â®• Agha", online: "Online", offline: "Offline Mode" }
    };

    const sntfData = [
        { d: "06:15", a: "07:05", t: "Reg" },
        { d: "06:45", a: "07:35", t: "Fast" },
        { d: "07:25", a: "08:15", t: "Reg" },
        { d: "12:30", a: "13:20", t: "Reg" },
        { d: "17:15", a: "18:05", t: "Fast" }
    ];

    let currentLang = 'ar';
    let map;

    // 2. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„ØºØ©
    function changeLanguage() {
        currentLang = document.getElementById('lang-selector').value;
        const t = translations[currentLang];
        document.getElementById('app-logo').innerText = t.logo;
        document.getElementById('gps-btn').innerHTML = `<i class="fas fa-location-crosshairs"></i> ${t.gps}`;
        document.getElementById('time-title').innerText = t.time;
        document.getElementById('sync-btn').innerText = t.sync;
        document.getElementById('map-title').innerText = t.map;
        document.getElementById('route-title').innerText = t.route;
        document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        updateOnlineStatus();
    }

    // 3. Ù†Ø¸Ø§Ù… Offline (LocalStorage)
    function syncData() {
        localStorage.setItem('sntf_cache', JSON.stringify(sntfData));
        renderSchedule();
        alert(currentLang === 'ar' ? "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!" : "Saved successfully!");
    }

    function renderSchedule() {
        const cached = localStorage.getItem('sntf_cache');
        const data = cached ? JSON.parse(cached) : sntfData;
        const body = document.getElementById('schedule-body');
        body.innerHTML = data.map(i => `<tr><td>${i.d}</td><td>â®•</td><td>${i.a}</td><td><small>${i.t}</small></td></tr>`).join('');
    }

    // 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø®Ø±Ø§Ø¦Ø·
    function initMap() {
        map = L.map('map', { zoomControl: false }).setView([36.65, 3.0], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.marker([36.5050, 2.8610]).addTo(map).bindPopup("Beni Mered");
        L.marker([36.7645, 3.0515]).addTo(map).bindPopup("Agha");
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                alert(currentLang === 'ar' ? "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚Ø±Ø¨ Ù…Ø­Ø·Ø©..." : "Locating nearest station...");
            });
        }
    }

    // 5. Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
    function updateOnlineStatus() {
        const ind = document.getElementById('net-indicator');
        const isOnline = navigator.onLine;
        ind.className = `net-status ${isOnline ? 'online' : 'offline'}`;
        ind.innerText = isOnline ? translations[currentLang].online : translations[currentLang].offline;
    }

    function toggleTheme() { document.body.classList.toggle('dark-mode'); }

    window.onload = () => {
        changeLanguage();
        renderSchedule();
        initMap();
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
    };
</script>
</body>
</html>
