<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNTF Go - Live Tracking</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        :root { --p: #006d3a; --s: #f3f4f1; --c: #ffffff; --t: #1a1c19; }
        .dark-mode { --s: #111411; --c: #1c1f1c; --t: #e2e3dd; }

        body { background: var(--s); color: var(--t); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; transition: 0.3s; }
        .app-container { max-width: 500px; margin: auto; }
        .card { background: var(--c); border-radius: 24px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        .search-group { position: relative; margin-bottom: 15px; }
        .input-box { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ccc; background: var(--s); color: var(--t); box-sizing: border-box; }
        
        .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: var(--c); border-radius: 0 0 12px 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); z-index: 1000; max-height: 200px; overflow-y: auto; display: none; }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid var(--s); }

        .btn-live { background: #d32f2f; color: white; border: none; width: 100%; padding: 15px; border-radius: 50px; font-weight: bold; cursor: pointer; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); } 100% { transform: scale(0.95); } }

        #map { height: 300px; border-radius: 20px; margin-top: 15px; }
        .lang-select { padding: 8px; border-radius: 10px; background: var(--c); color: var(--t); }
    </style>
</head>
<body class="light-mode">

<div class="app-container">
    <header style="display: flex; justify-content: space-between; align-items: center; padding: 10px;">
        <h2 id="logo-text">SNTF Go</h2>
        <div style="display: flex; gap: 5px;">
            <select id="lang-select" class="lang-select" onchange="updateLang()">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
            </select>
            <button onclick="document.body.classList.toggle('dark-mode')" style="background:none; border:none; font-size:1.5rem;">ğŸŒ™</button>
        </div>
    </header>

    <div class="card">
        <label id="label-from">ğŸ“ Ù…Ø­Ø·Ø© Ø§Ù„Ø°Ù‡Ø§Ø¨:</label>
        <div class="search-group">
            <input type="text" id="from-input" class="input-box" onkeyup="searchSt('from')">
            <div id="from-list" class="suggestions"></div>
        </div>

        <button class="btn-live pulse" onclick="startLiveTracking()">
            <i class="fas fa-satellite-dish"></i> <span id="btn-live-text">ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­ÙŠ Ø¹Ø¨Ø± GPS</span>
        </button>
    </div>

    <div id="result-section" class="card" style="display:none;">
        <div id="map"></div>
        <div id="info" style="margin-top:15px; text-align:center; font-weight:bold; color:var(--p);"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const i18n = {
        ar: { from: "ğŸ“ Ù…Ø­Ø·Ø© Ø§Ù„Ø°Ù‡Ø§Ø¨:", live: "ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­ÙŠ Ø¹Ø¨Ø± GPS", info: "Ø¬Ø§Ø±ÙŠ ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ...", logo: "SNTF Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±" },
        en: { from: "ğŸ“ Departure Station:", live: "Enable Live GPS Tracking", info: "Tracking your current location...", logo: "SNTF Algeria" },
        fr: { from: "ğŸ“ Station de DÃ©part:", live: "Activer le Suivi GPS en Direct", info: "Suivi de votre position actuelle...", logo: "SNTF AlgÃ©rie" }
    };

    const stations = [
        { name: "Beni Mered - Ø¨Ù†ÙŠ Ù…Ø±Ø§Ø¯", lat: 36.5050, lng: 2.8610 },
        { name: "Boufarik - Ø¨ÙˆÙØ§Ø±ÙŠÙƒ", lat: 36.5744, lng: 2.9119 },
        { name: "Agha - Ø¢ØºØ§", lat: 36.7645, lng: 3.0515 }
    ];

    let map, userMarker, watchId;

    function updateLang() {
        const l = document.getElementById('lang-select').value;
        document.getElementById('label-from').innerText = i18n[l].from;
        document.getElementById('btn-live-text').innerText = i18n[l].live;
        document.getElementById('logo-text').innerText = i18n[l].logo;
        document.documentElement.dir = l === 'ar' ? 'rtl' : 'ltr';
    }

    function searchSt(type) {
        const input = document.getElementById(`${type}-input`);
        const list = document.getElementById(`${type}-list`);
        const query = input.value.toLowerCase();
        list.innerHTML = "";
        if (query.length < 1) return;

        stations.filter(s => s.name.toLowerCase().includes(query)).forEach(s => {
            const div = document.createElement("div");
            div.className = "suggestion-item";
            div.innerText = s.name;
            div.onclick = () => { input.value = s.name; list.style.display="none"; };
            list.appendChild(div);
        });
        list.style.display = "block";
    }

    function startLiveTracking() {
        if (!navigator.geolocation) return alert("GPS not supported");

        document.getElementById('result-section').style.display = 'block';
        if (!map) {
            map = L.map('map').setView([36.5050, 2.8610], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }

        // Ø®Ø§ØµÙŠØ© Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø­ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        watchId = navigator.geolocation.watchPosition(pos => {
            const { latitude, longitude } = pos.coords;
            const latlng = [latitude, longitude];

            if (!userMarker) {
                userMarker = L.marker(latlng, {
                    icon: L.divIcon({ className: 'custom-div-icon', html: "<div style='background-color:#d32f2f;width:15px;height:15px;border-radius:50%;border:2px solid white;'></div>", iconSize: [15, 15] })
                }).addTo(map).bindPopup("You are here").openPopup();
            } else {
                userMarker.setLatLng(latlng);
            }
            map.setView(latlng);
            document.getElementById('info').innerText = i18n[document.getElementById('lang-select').value].info;
        }, err => console.error(err), { enableHighAccuracy: true });
    }
</script>
</body>
</html>
