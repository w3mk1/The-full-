<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNTF Live Pro - Speed & Tracker</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <style>
        :root { --p: #006d3a; --s: #f3f4f1; --c: #ffffff; --t: #1a1c19; --danger: #d32f2f; }
        .dark-mode { --s: #111411; --c: #1c1f1c; --t: #e2e3dd; }

        body { background: var(--s); color: var(--t); font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding: 10px; transition: 0.3s; }
        .app-container { max-width: 500px; margin: auto; }
        
        .card { background: var(--c); border-radius: 24px; padding: 20px; margin-bottom: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø© */
        .dashboard { display: flex; justify-content: space-around; align-items: center; margin-bottom: 15px; }
        .speed-circle { 
            width: 120px; height: 120px; border-radius: 50%; 
            border: 6px solid var(--s); border-top-color: var(--p);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .max-speed-box { text-align: center; color: var(--danger); font-weight: bold; }

        /* Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø·Ø§Øª */
        .input-group { margin-bottom: 15px; position: relative; }
        input { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ccc; 
            background: var(--s); color: var(--t); box-sizing: border-box; font-size: 14px;
        }
        .suggestions { 
            position: absolute; width: 100%; background: var(--c); z-index: 1000; 
            border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-height: 150px; overflow-y: auto; display: none;
        }
        .s-item { padding: 10px; cursor: pointer; border-bottom: 1px solid var(--s); font-size: 13px; }

        #map { height: 200px; border-radius: 18px; margin-top: 10px; }
        .btn-start { 
            background: var(--p); color: white; border: none; width: 100%; 
            padding: 15px; border-radius: 50px; font-weight: bold; cursor: pointer; 
        }

        header { display: flex; justify-content: space-between; align-items: center; padding: 5px 10px; }
        .lang-select { padding: 5px; border-radius: 8px; background: var(--c); color: var(--t); }
    </style>
</head>
<body class="light-mode">

<div class="app-container">
    <header>
        <h3 id="logo">SNTF Go Pro</h3>
        <div style="display:flex; gap:10px;">
            <select id="lang" class="lang-select" onchange="updateLang()">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="en">English</option>
                <option value="fr">FranÃ§ais</option>
            </select>
            <button onclick="document.body.classList.toggle('dark-mode')" style="background:none; border:none; font-size:1.2rem; cursor:pointer;">ðŸŒ™</button>
        </div>
    </header>

    <div class="card dashboard">
        <div class="speed-circle">
            <span style="font-size: 0.8rem;" id="label-speed">Ø§Ù„Ø³Ø±Ø¹Ø©</span>
            <span id="current-speed" style="font-size: 2.2rem; font-weight: bold;">0</span>
            <span style="font-size: 0.7rem;">KM/H</span>
        </div>
        <div class="max-speed-box">
            <i class="fas fa-fire"></i> <span id="label-max">Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</span><br>
            <span id="max-speed" style="font-size: 1.5rem;">0</span> <small>KM/H</small>
        </div>
    </div>

    <div class="card">
        <div class="input-group">
            <input type="text" id="from-in" placeholder="Ù…Ø­Ø·Ø© Ø§Ù„Ø°Ù‡Ø§Ø¨..." onkeyup="search('from')">
            <div id="from-list" class="suggestions"></div>
        </div>
        <div class="input-group">
            <input type="text" id="to-in" placeholder="Ù…Ø­Ø·Ø© Ø§Ù„Ù‚Ø¯ÙˆÙ…..." onkeyup="search('to')">
            <div id="to-list" class="suggestions"></div>
        </div>
        <button class="btn-start" onclick="startTracking()" id="btn-text">Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© ÙˆØ§Ù„ØªØªØ¨Ø¹</button>
    </div>

    <div id="map-card" class="card" style="display:none;">
        <div id="map"></div>
        <p id="status" style="text-align:center; font-size:0.8rem; margin-top:10px;"></p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const i18n = {
        ar: { logo: "SNTF Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", speed: "Ø§Ù„Ø³Ø±Ø¹Ø©", max: "Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰", from: "Ù…Ø­Ø·Ø© Ø§Ù„Ø°Ù‡Ø§Ø¨...", to: "Ù…Ø­Ø·Ø© Ø§Ù„Ù‚Ø¯ÙˆÙ…...", btn: "Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© ÙˆØ§Ù„ØªØªØ¨Ø¹", status: "Ø¬Ø§Ø±ÙŠ ØªØªØ¨Ø¹ Ø§Ù„Ø±Ø­Ù„Ø©..." },
        en: { logo: "SNTF Algeria", speed: "Speed", max: "Max Speed", from: "Departure...", to: "Arrival...", btn: "Start Tracking", status: "Tracking trip..." },
        fr: { logo: "SNTF AlgÃ©rie", speed: "Vitesse", max: "Vitesse Max", from: "DÃ©part...", to: "ArrivÃ©e...", btn: "DÃ©marrer", status: "Suivi en cours..." }
    };

    const stations = ["Ø¨Ù†ÙŠ Ù…Ø±Ø§Ø¯ (Beni Mered)", "Ø¨ÙˆÙØ§Ø±ÙŠÙƒ (Boufarik)", "Ø¨Ø¦Ø± ØªÙˆØªØ© (Birtouta)", "Ø§Ù„Ø­Ø±Ø§Ø´ (El Harrach)", "Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± - Ø¢ØºØ§ (Agha)", "Ø§Ù„Ø¨Ù„ÙŠØ¯Ø© (Blida)", "Ø§Ù„Ø¹ÙØ±ÙˆÙ† (El Affroun)"];
    
    let map, userMarker, maxS = 0;

    function updateLang() {
        const l = document.getElementById('lang').value;
        const t = i18n[l];
        document.getElementById('logo').innerText = t.logo;
        document.getElementById('label-speed').innerText = t.speed;
        document.getElementById('label-max').innerText = t.max;
        document.getElementById('from-in').placeholder = t.from;
        document.getElementById('to-in').placeholder = t.to;
        document.getElementById('btn-text').innerText = t.btn;
        document.documentElement.dir = l === 'ar' ? 'rtl' : 'ltr';
    }

    function search(id) {
        const val = document.getElementById(`${id}-in`).value.toLowerCase();
        const list = document.getElementById(`${id}-list`);
        list.innerHTML = "";
        if(!val) { list.style.display = "none"; return; }
        
        stations.filter(s => s.toLowerCase().includes(val)).forEach(s => {
            const d = document.createElement("div");
            d.className = "s-item"; d.innerText = s;
            d.onclick = () => { document.getElementById(`${id}-in`).value = s; list.style.display = "none"; };
            list.appendChild(d);
        });
        list.style.display = "block";
    }

    function startTracking() {
        if (!navigator.geolocation) return alert("GPS Error");
        document.getElementById('map-card').style.display = "block";
        
        if (!map) {
            map = L.map('map').setView([36.5050, 2.8610], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        }

        navigator.geolocation.watchPosition(pos => {
            const { latitude, longitude, speed } = pos.coords;
            const currentKmH = Math.round((speed || 0) * 3.6);
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø±Ø¹Ø©
            document.getElementById('current-speed').innerText = currentKmH;
            if(currentKmH > maxS) {
                maxS = currentKmH;
                document.getElementById('max-speed').innerText = maxS;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            const loc = [latitude, longitude];
            if (!userMarker) { userMarker = L.marker(loc).addTo(map); } 
            else { userMarker.setLatLng(loc); }
            map.panTo(loc);
            
            document.getElementById('status').innerText = i18n[document.getElementById('lang').value].status;
        }, null, { enableHighAccuracy: true });
    }

    window.onload = updateLang;
</script>
</body>
</html>
